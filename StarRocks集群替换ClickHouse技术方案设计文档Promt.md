# 原始promt
你是一个大叔据解决方案专家，请根据一下描述的【场景】，按照【要求】输出尽可能多的解决方案，并且对解决方案进行对比选型，然后按照【章节要求】输出完整的设计文档，要求图表不少于20个，字数不少于5000字
【场景】
客户有三台设备，上边跑了一些服务和Clickhouse，clickhouse是用来存储原数数据的，并且提供给业务查询，目前clickhouse已经存储了大约50TB的数据，分散在60张表中，这些数据的TTL统一为180天，由于业务战略变换，需要将设备上的clickhouse替换为starrocks。

【要求】
1、Clikhouse替换为starrocks过程中数据不能有丢失  

2、Clikhouse替换为starrocks过程中业务查询不能有长时间的中断  

3、只能在原系统上替换，不能新增硬件资源  

4、现有服务依赖：服务是直接查询clickhouse的，读写qps比例为1:10，服务层可以适配切换过程，比如切换时服务层可以统一使用SR的语法，但是不能让 服务同事使用SR的语法和CK的语法，这在数据聚合时会出现问题  

5、硬件规格：三台设备都是32C256GB的硬件设备，每台机器上都有8块16TB的HDD组raid5存储数据，网口是万兆口，当前系统CPU使用率伟60%，内存使用率为70%，磁盘容量使用率为60%  

6、中断容忍度：系统的维护时间窗口是8小时，即业务中断时间最长不超过8小时  

7、数据写入情况：迁移期间会停止数据写入  

8、ClickHouse部署细节：clickhouse是集群模式，每台主机上1个分片，没有副本  

9、StarRocks 要求：StarRocks 是基于3.3的稳定版本的，查询会涉及多个表  

10、其他约束：替换动作不一定要在运维周期内完成，只是需要业务上无感就可以了。比如可以考虑staarocks中支持Clickhouse的数据源，然后新数据直接写starrocks，在starrocks中通过视图的方式让用户同时使用CLickhouse和Starrocks的数据，待Clickhouse中的数据全部过期后再把Clickhouse下线掉，彻底切换为starrocks，这只是个想法距离，具体请大模型自己思考  

【章节要求】
1、背景介绍：{这里输出整个项目的背景}  

2、目标：{这里输出方案的目标}  

3、缩写及专业名词定义：{这里输出方案中专业词汇或者缩写的定义，如果开源组件需要大致描述开源组件的功能}  

4、性能规格及约束：{这里方案设计的一些性能规格及可靠性、稳定性等相关的约束，大模型需要自行探索核心维度，但是不要过度发散，保持专业性}  

5、方案选型：：{这里需要详细描述每一个方案的原理、实现过程、设计图，风险分析等，大模型需要自行补充，确保小白也能看得懂}  

6、方案选型评估：{这里需要输出一个表格，从各个维度对比上述方案选型的优缺点，需要大模型自己发散，要保持专业性，并且需要给出每个选型最终的评分，以及最终选型方案}  

7、选型方案可靠性设计：{这里需要输出上述最终选型方案的可靠性、稳定性、可测试性、可调试性、安全性等相关的设计}  



gpt优化后的promt：
你是一个大数据解决方案专家，请按照以下要求完成设计文档

#### 【项目背景与技术约束】  
某企业需在3台32C/256GB/8×16TB HDD（RAID5）服务器集群中，将现有ClickHouse集群（50TB数据/60张表，TTL 180天，无副本分片架构）替换为StarRocks 3.3版本。当前系统CPU使用率60%、内存70%、磁盘60%，万兆网络环境，服务层读写QPS比1:10，需满足以下核心约束：  
1. 数据零丢失迁移，业务中断≤8小时  
2. 禁止新增硬件，复用现有资源  
3. 服务层仅支持单一查询语法（StarRocks），需避免CK/SR语法混用  

#### 【技术方案设计要求】  
请按照企业级技术方案标准，完成以下内容设计，确保方案具备可落地性与风险可控性：  

##### 一、基础架构与术语定义（必含）  
1. 明确ClickHouse/StarRocks技术架构差异（如MPP架构、存储引擎、查询优化机制）  
2. 定义关键术语：TTL、QPS、RAID5、物化视图、联邦查询、Stream Load  

##### 二、性能指标与约束条件（量化要求）  
| 维度 | 指标要求 | 技术实现参考 |  
|------|----------|--------------|  
| 数据迁移效率 | ≥10TB/小时（单节点） | 基于万兆网络与磁盘I/O测算 |  
| 查询响应时间 | 聚合查询≤500ms，明细查询≤2s | 参考StarRocks向量化执行引擎性能 |  
| 资源占用阈值 | CPU≤80%，内存≤90%，磁盘I/O≤70% | 现有硬件资源利用率上限 |  
| 数据一致性 | 校验通过率100% | 提供校验工具与脚本示例 |  

##### 三、全链路解决方案（核心模块）  
需包含至少4种可行技术方案，每个方案需详细说明：  
1. **技术原理**：结合StarRocks联邦查询/物化视图/MPP并行计算等特性  
2. **实施路径**：  
   - 集群部署架构图（含CK/SR节点资源分配）  
   - 数据迁移流程图（含停机窗口规划）  
   - 服务层适配方案（API改造点/语法兼容策略）  
3. **风险控制**：  
   - 资源竞争解决方案（CPU/内存/网络限流策略）  
   - 数据不一致应急预案（双写回滚/分片重试机制）  
   - 性能劣化优化方案（谓词下推/索引优化/物化视图设计）  
4. **代码实现**：提供关键技术点代码示例（如联邦查询SQL、双写事务逻辑、分片迁移脚本）  

##### 四、方案对比与选型依据  
设计多维度评估矩阵（建议包含数据一致性、中断时间、资源占用、开发成本、风险等级5个以上维度），通过量化评分（1-10分）给出最优方案，并说明企业级落地优势（如京东云/汽车之家实践参考）。  

##### 五、可靠性设计（企业级要求）  
1. **容灾架构**：单节点故障切换机制（0-30秒恢复）  
2. **监控体系**：  
   - 核心指标：QPS、延迟、资源利用率、慢查询率  
   - 告警阈值：CPU>85%/内存>90%/延迟>1.5s（聚合查询）  
3. **安全设计**：数据加密传输（TLS 1.3）、访问控制（RBAC+IP白名单）  
4. **可观测性**：提供Prometheus+Grafana监控模板与日志规范  

##### 六、实施计划与里程碑  
分阶段制定执行计划（建议包含集群搭建、数据迁移、服务切换、压测验收4个阶段），明确各阶段耗时、关键任务与验收标准，确保8小时停机窗口内完成核心切换。  

#### 【输出格式规范】  
1. 采用技术方案标准文档结构，包含背景、目标、技术方案、选型评估、可靠性设计、实施计划6大核心章节  
2. 图表要求：架构图/流程图/评估矩阵等合计≥20个  
3. 代码规范：提供Java/Python/SQL示例，关键逻辑添加注释  
4. 案例参考：引用至少3个业界实践（如白山云联邦查询优化、携程Flink CDC迁移案例）  

请按照上述专业技术方案框架，输出逻辑严谨、技术细节完整、具备企业级落地价值的设计文档，确保方案可直接指导运维与开发团队实施。
